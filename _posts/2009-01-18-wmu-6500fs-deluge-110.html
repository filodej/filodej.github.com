--- 
name: wmu-6500fs-deluge-110
layout: post
time: 2009-01-18 00:32:00 +01:00
title: WMU-6500FS - Deluge 1.1.0
---
The new deluge version is here!

<h3>Build result</h3>
<a href="http://filodej.ic.cz/filopack/deluge-1.1.0.tar.bz2">[binary]</a>
<a href="http://filodej.ic.cz/filopack/.filopack/deluge-1.1.0.lst">[file list]</a>
<br/>

<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_xFBIBcRhwFQ/SXJr5W8TlDI/AAAAAAAACd8/G78RzkxDhsE/s1600-h/gtkui.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 342px;" src="http://1.bp.blogspot.com/_xFBIBcRhwFQ/SXJr5W8TlDI/AAAAAAAACd8/G78RzkxDhsE/s400/gtkui.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5292411145268991026" /></a>

If you don't have the previous version (deluge-1.0.5) installed, follow the previous <a href="http://filodej.blogspot.com/2008/11/wmu-6500fs-deluge-torrent-part-iv.html">deluge post</a>, install all the prerequisites and dependencies and come back here for the rest. Note that the <a href="http://filodej.ic.cz/filopack/deluge-1.0.5-gcclibs.tar.bz2">deluge-1.0.5-gcclibs package</a> is valid even for deluge-1.1.0, so don't get confused with its misleading name.<br/>
On the other hand if you have the <i>deluge-1.0.5</i> installed, you have to clean it up first (while preserve all the already installed dependencies).
<span class="fullpost">
<br/>
<br/>
Stop the deluge daemon if it is running. You can do it via console:
<pre class="code">
box# <b>deluge --ui=null</b>
&gt;&gt;&gt; <b>halt</b>
&gt;&gt;&gt; quit
Thanks!

</pre>

or forcibly:

<pre class="code">
box# <b>killall deluged</b>
</pre>

Now uninstall the previous version:
<pre class="code">
dev# cd /mnt/C/
dev# <b>./filopack.sh --remove deluge-1.0.5</b>
Configuration file .filopack/.config file found and used
Sure to remove deluge-1.0.5 locally at /mnt/C (y/n)?<b>y</b>
...
</pre>
If you are not using the <a href="http://filodej.blogspot.com/2008/11/simple-packaging-sysetm.html">filopack packaging system</a>, you can remove the previous version as follows:
<pre class="code">
box# cd /mnt/C/
box# wget <a href="http://filodej.ic.cz/filopack/.filopack/deluge-1.0.5.lst">http://filodej.ic.cz/filopack/.filopack/deluge-1.0.5.lst</a>
box# xargs rm -f < deluge-1.0.5.lst
</pre>

It is likely that deluge developers preserved the compatibility of configuration and the following step is not necessary, I just to be sure delete the configuration as well: 
<pre class="code">
box# <b>mv ~/.config/deluge{,.del}</b>
</pre>
Now we are ready to install the new version:
<pre class="code">
box# <b>./filopack.sh --install deluge-1.1.0</b>
Sure to unpack deluge-1.1.0 locally at /mnt/C (y/n)? <b>y</b>
...
</pre>
Now we are ready to try the daemon, still it is necessary to use the <i>LD_PRELOAD</i> prefix or <i>deluged.sh</i> script - now updated in order to support parameters (like <i>-d</i> for example) - see <a href="http://www.macsat.com/macsat/component/option,com_smf/Itemid,50/topic,690.msg4808/#msg4808">this 
post on mascat</a> for details - if we are lucky, everything runs smoothly:
<pre class="code">
box# <b>deluged.sh</b>
</pre>
<h3>Default GUI</h3>
It is possible to set a default GUI (if you prefer other than predefined GTK GUI):
<pre class="code">
box# <b>deluge --set-default-ui=console</b>
The default UI has been changed to console
</pre>
It is nice that now it is not necessary to modify the configuration by hand (like it is described <a href="http://www.macsat.com/macsat/component/option,com_smf/Itemid,50/topic,690.msg4808/#msg4808">here</a>).
<h3>Remote access</h3>
The CLI ui has been renamed from <i>null</i> to <i>console</i>. Notice that it is necessary to use LD_PRELOAD prefix just for daemon and GTK GUI, there is no need to use it for the console UI).<br/>
We can use it for enabling the remote access (we have to restart the daemon in order to make the change active):
<pre class="code">
box# deluge --ui=<b>console</b>
&gt;&gt;&gt; <b>config --set allow_remote True</b>
&gt;&gt;&gt; halt
&gt;&gt;&gt; quit
Thanks!

box# deluged.sh
</pre>
<h3>Authentication</h3>
Another new feature is the user authentication. For details see <a href="http://dev.deluge-torrent.org/wiki/Authentication">[Authentication]</a> and <a href="http://dev.deluge-torrent.org/wiki/ThinClient">[ThinClient settings]</a>. Without adding a username and password to <i>~/.config/deluge/auth</i> configuration file you won't be able to remotely connect to the daemon nor event see whether the daemon is running (which is a nice). 
<br/>
<br/>
<i>Edit: since the ~/.config/deluge/auth file initially does not contain trailing newline the instructions did not work, now it is updated appropriately</i>
<pre class="code">
box# <b>echo -n -e "\n<i>&lt;username&gt;:&lt;password&gt;</i>" &gt;&gt; ~/.config/deluge/auth</b>
</pre>

<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_xFBIBcRhwFQ/SXJr5HUMQLI/AAAAAAAACd0/Q1MOgt62h-Q/s1600-h/auth.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 264px;" src="http://1.bp.blogspot.com/_xFBIBcRhwFQ/SXJr5HUMQLI/AAAAAAAACd0/Q1MOgt62h-Q/s400/auth.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5292411141074206898" /></a>

Be sure to <b>append</b> to the file, in case you rewrote the file you won't have been able to connect to it locally, since it initially contains a <i>localclient</i> record. If you accidentally rewrite the file, you can just delete it, restart the daemon and a ui (e.g. the console) and the default file containing <i>localclient</i> authentication info is created for you.
<br/>
<br/>
<h3>Web GUI</h3>
If you want to use the Web GUI (and new Ajax UI seems pretty good to me), now it is not necessary to run the web client on the same machine as daemon. 

<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_xFBIBcRhwFQ/SXJr4u1Kg1I/AAAAAAAACds/gffLePEFt5I/s1600-h/ajaxui.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 309px;" src="http://1.bp.blogspot.com/_xFBIBcRhwFQ/SXJr4u1Kg1I/AAAAAAAACds/gffLePEFt5I/s400/ajaxui.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5292411134501618514" /></a>

Via the Web GUI you can connect to any daemon you want (not just <i>localhost</i>). 

<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_xFBIBcRhwFQ/SXJr5UywyvI/AAAAAAAACeE/jc7iZrZ86mE/s1600-h/webui.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 320px;" src="http://2.bp.blogspot.com/_xFBIBcRhwFQ/SXJr5UywyvI/AAAAAAAACeE/jc7iZrZ86mE/s400/webui.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5292411144692091634" /></a>

Not sure whether I personally utilize it, but it seems to me like a nice feature.
<br/>
<br/>
That's all folks.
<br/>
(The following text is just a (boring) build protocol, totally unnecessary for ordinary users ;-)
<h3>Build sequence</h3>
It was about the same like in previous version so just in short:
<br/>
<br/>
Remove the previous version:
<pre class="code">
dev# cd /mnt/C/
dev# ./filopack.sh --remove deluge-1.0.5
Configuration file .filopack/.config file found and used
Sure to remove deluge-1.0.5 locally at /mnt/C (y/n)?y
...
</pre>
Init the timestamp for the new one:
<pre class="code">
dev# ./filopack.sh --init  deluge-1.1.0
Configuration file .filopack/.config file found and used
Timestamp written to file .filopack/deluge-1.1.0.ts
</pre>
Download and extract the source:
<pre class="code">
dev# cd /usr/local/src
dev# wget <a href="http://download.deluge-torrent.org/source/1.1.0/deluge-1.1.0.tar.bz2">http://download.deluge-torrent.org/source/1.1.0/deluge-1.1.0.tar.bz2</a>
...
04:37:59 (55.28 KB/s) - `deluge-1.1.0.tar.bz2' saved [2196924/2196924]

dev# tar xjvf deluge-1.1.0.tar.bz2
dev# cd deluge-1.1.0
</pre>
Setup the include and library paths:
<pre class="code">
dev# export CFLAGS=-I/mnt/C/sys/include/boost-1_35
dev# export LDFLAGS=-L/mnt/C/sys/lib
</pre>
Add the missing define:
<pre class="code">
nano libtorrent/include/libtorrent/socket.hpp
<i>
      #ifndef IPV6_V6ONLY
      #define IPV6_V6ONLY 26
      #endif
</i>
</pre>
I did not find the <i>libtorrent/src/memdebug.cpp</i>, so undefining the content of this file is not necessary anymore.
<br/>
<br/>
Build the code and install the binaries:
<pre class="code">
dev# python setup.py build
...
dev# python setup.py install --prefix=/mnt/C/sys/
...
</pre>
Try to run the daemon:
<pre class="code">
dev# deluged
dev# /usr/bin/python: can't resolve symbol '__cxa_pure_virtual'
</pre>
... issue wit h unresolved symbol is still the same. As a workaround the <i>LD_PRELOAD</i> prefix can be used. Let;s create scripts for it:
<pre class="code">
dev# echo LD_PRELOAD=\"/usr/lib/libssl.so.0.9.7 /usr/lib/libboost_filesystem-gcc41-mt-1_35.so.1.35.0\" deluged \"\$@\" > /mnt/C/sys/bin/deluged.sh
dev# chmod +x /mnt/C/sys/bin/deluged.sh 
dev# echo LD_PRELOAD=\"/usr/lib/libssl.so.0.9.7 /usr/lib/libboost_filesystem-gcc41-mt-1_35.so.1.35.0\" deluge \"\$@\" > /mnt/C/sys/bin/deluge.sh
dev# chmod +x /mnt/C/sys/bin/deluge.sh 
</pre>
Now the daemon runs ok:
<pre class="code">
dev# deluged.sh
</pre>
Let's try the GTK client:
<pre class="code">
dev# deluge --version
1.1.0
dev# deluge
...
  File "/mnt/C/sys/lib/python2.5/site-packages/deluge-1.1.0-py2.5-linux-i686.egg/deluge/ui/gtkui/common.py", line 

45, in get_logo
    size, size)
gobject.GError: Unrecognized image file format
</pre>
ChangeAs a fix we can change the extension:
<pre class="code">
dev# sed -i 's/deluge.svg/deluge.png/g' /mnt/C/sys/lib/python2.5/site-packages/deluge/ui/gtkui/common.py
dev# deluge
</pre>
Touch related files with older timestamps (in order to include them to the package):
<pre class="code">
dev# find /mnt/C/sys -path "*deluge*" -type f -exec touch {} \;
</pre>
Then we are ready to create the package:
<pre class="code">
dev# cd /mnt/C/sys
dev# ./filopack.sh --pack deluge-1.1.0
...
</pre>
I noticed that there was duplicity after the installation which made the package twice as big as was necessary:
It seems to me that whole directory tree <i>/mnt/C/sys/lib/python2.5/site-packages/deluge-1.1.0-py2.5-linux-i686.egg/deluge</i> was redundant - directory <i>/mnt/C/sys/lib/python2.5/site-packages/deluge</i> had a similar content (including the huge <i>libtorrent.so</i>). I just dropped the former one and everything seems ok and package has 16MB (compared to 31MB).

</span><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/183431720687819497-3428560276724848481?l=filodej.blogspot.com' alt='' /></div>

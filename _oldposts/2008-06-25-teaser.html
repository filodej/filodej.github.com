--- 
name: teaser
layout: post
time: 2008-06-25 23:35:00 +02:00
title: WMU-6500FS - X.Org 7.1 (updated)
---
Just for fun I am trying to build <a href="http://www.x.org/wiki/">X.Org</a> and it seems it won't be such a problem to finish it. There are many issues remaining to be solved but at least for now I am able to run couple of simple X-applications.
<br/>
<i>Update:</i> I have not finished the X server yet, but have built X.Org libraries, so now it is possible to build X client applications.
<br/>
<b>Build results:</b>
<a href="http://rapidshare.com/files/125380138/x11-7.1.tar.bz2.html">[binary (82MB)]</a>
<a href="http://philodej.googlepages.com/x11-7.1.lst">[list files]</a>
<br/>
<br/>
Following image demonstrates the <a href="http://linuxcommand.org/man_pages/xcalc1.html">xcalc</a> application running on the box acting as X-client of the <a href="http://en.wikipedia.org/wiki/Xming">XMing server</a> running on my PC :-)
<br/>
<br/>
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_xFBIBcRhwFQ/SFW1kogfhwI/AAAAAAAABdE/0AlxoIef-fM/s1600-h/xcalc.png"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer;" src="http://1.bp.blogspot.com/_xFBIBcRhwFQ/SFW1kogfhwI/AAAAAAAABdE/0AlxoIef-fM/s400/xcalc.png" alt="" id="BLOGGER_PHOTO_ID_5212271784704837378" border="0" /></a>
<br/>
<br/>
<span class="fullpost">
<b>Dependencies:</b> 
<a href="http://filodej.blogspot.com/2008/06/wmu-6500fs-m4-1411.html">[m4-1.4.11]</a>
<a href="http://filodej.blogspot.com/2008/06/wmu-6500fs-libxslt-1122.html">[libxslt-1.1.22]</a>
<a href="http://filodej.blogspot.com/2008/06/wmu-6500fs-xmlto-0020.html">[xmlto 0.0.20]</a>
<a href="">[Mesa 7.0.3]</a>
[rsh (fake with <i>ssh</i> alias)]
<br/>
<b>Info sources:</b>
<br/>
  <a href="http://www.linuxfromscratch.org/blfs/view/svn/x/installing.html">[X Window System Environment]</a><br/>
  <a href="http://www.x.org/wiki/ModularDevelopersGuide">[Modular Developer's Guide]</a><br/>
  <a href="http://www.x.org/wiki/Development/git">[Modular X development using the git trees]</a><br/>
  <a href="http://linuxdevices.com/articles/AT9202043619.html">[Embedded Linux Graphics Quick Reference Guide]</a><br/>
<br/>
<br/>
<b>Build sequence:</b>
<br/>
Create source directory and download git_xorg script (will be used to get all xorg modular components from git repository)
<pre class="code">
dev# cd /usr/local/src
dev# mkdir Xorg
dev# cd Xorg
dev# wget "<a href="http://www.x.org/wiki/ModularDevelopersGuide?action=AttachFile&do=get&target=git_xorg.sh">http://www.x.org/wiki/ModularDevelopersGuide?action=AttachFile&do=get&target=git_xorg.sh</a>" -O git_xorg.sh
dev# chmod a+x git_xorg.sh
dev# echo "do_dir xorg font \"\${font}\"        # this line added to get fonts" &gt;&gt; git_xorg.sh
</pre>
Customize git_xorg script<br/>
<pre class="code">
dev# nano git_xorg.sh
</pre>
... you can for example remove all <tt>xf86-video-*</tt> drivers and related stuff, 
remove <tt>do_dir . xcb "${xcb}"</tt>, 
add <tt>do_dir xorg font "${font}"</tt> in order to download fonts, etc.

<pre class="code">
dev # diff git_xorg.sh git_xorg.sh.orig
50c50,65
<       xf86-input-vmmouse xf86-input-void"
---
>       xf86-input-vmmouse xf86-input-void xf86-video-apm\
>       xf86-video-ark xf86-video-ast xf86-video-ati\
>       xf86-video-chips xf86-video-cirrus xf86-video-cyrix\
>       xf86-video-dummy xf86-video-fbdev xf86-video-glide\
>       xf86-video-glint xf86-video-i128 xf86-video-i740\
>       xf86-video-impact xf86-video-imstt xf86-video-intel\
>       xf86-video-mga xf86-video-neomagic xf86-video-newport\
>       xf86-video-nsc xf86-video-nv xf86-video-rendition\
>       xf86-video-s3 xf86-video-s3virge xf86-video-savage\
>       xf86-video-siliconmotion xf86-video-sis xf86-video-sisusb\
>       xf86-video-sunbw2 xf86-video-suncg14 xf86-video-suncg3\
>       xf86-video-suncg6 xf86-video-sunffb xf86-video-sunleo\
>       xf86-video-suntcx xf86-video-tdfx xf86-video-tga\
>       xf86-video-trident xf86-video-tseng xf86-video-v4l\
>       xf86-video-vesa xf86-video-vga xf86-video-via\
>       xf86-video-vmware xf86-video-voodoo xf86-video-wsfb"
129c144
< do_dir xorg font "${font}"        # this line added to get fonts
---
> do_dir . xcb "${xcb}"
</pre>
Now we can start downloading the source:
<pre class="code">
dev# ./git_xorg.sh
</pre>
And now we can try to run the build (we have not solved any dependencies yet, I decided to solve it along the way).
<br/>
The first one is the m4 preprocessor:
<pre class="code">
dev# PATH=/mnt/C/sys/X11/bin:$PATH ./util/modular/build.sh /mnt/C/sys/X11
    ...
    autom4te: need GNU m4 1.4 or later: /usr/bin/m4
</pre>
For info how to get and build the <i>m4</i> preprocessor see <a href="http://filodej.blogspot.com/2008/06/wmu-6500fs-m4-1411.html">this post</a>.
<br/>
Then there is xcb build error (in case one have not removed it from the <i>git_xorg.sh</i>):
<pre class="code">
dev# PATH=/mnt/C/sys/X11/bin:$PATH ./util/modular/build.sh /mnt/C/sys/X11
    ...
     configure: error: XCB requires xsltproc.
    /mnt/C/sys/X11/lib/libxcb-xlib.so: undefined reference to `backtrace_symbols'
    /mnt/C/sys/X11/lib/libxcb-xlib.so: undefined reference to `backtrace'
</pre>
It seems that uClibc does not implement the <i>backtrace</i> related stuff. As a solution we can re-configure the xcb:
<pre class="code">
dev# cp xcb/libxcb/configure.ac{,.backup}
dev# nano xcb/libxcb/configure.ac
</pre>
From the <i>configure.ac</i> comment out the following line:
<pre class="code">
    AC_CHECK_HEADER([execinfo.h], [AC_DEFINE(HAVE_BACKTRACE,1,[Has backtrace*() ...
</pre>
And then we can continue the build process, the next error is in the <i>libXcomposite</i>:
<pre class="code">
dev# PATH=/mnt/C/sys/X11/bin:$PATH ./util/modular/build.sh <b>-r xcb/libxcb</b> /mnt/C/sys/X11
    ...
    make[3]: Entering directory `/usr/local/src/Xorg/lib/libXcomposite/man'
    WARNING: configure did not find xmlto, cannot create Xcomposite.man without it
</pre>
For info how to get and build the <i>xmlto</i> see <a href="http://filodej.blogspot.com/2008/06/wmu-6500fs-xmlto-0020.html">this post</a>.
<br/>
The next problem was in <i>xconsole</i> application:
<pre class="code">
dev# PATH=/mnt/C/sys/X11/bin:$PATH ./util/modular/build.sh <b>-r lib/libXcomposite</b> /mnt/C/sys/X11
...
make[1]: Entering directory `/usr/local/src/Xorg/app/xconsole'
...
In file included from xconsole.c:185:
/usr/include/sys/stropts.h:1:21: stropts.h: No such file or directory
</pre>
uClibc does not implement streams and so the fact that the <i>stropts.h</i> header file is missing is understandable.<br/> 
Commenting out the include in <i>xconsole.c</i> file semms to work. For more info about this issue see <a href="http://bugs.gentoo.org/show_bug.cgi?id=131318">this</a> source.
<br/>
After the <i>xconsole.c</i> modification we can try to continue the build process:
<pre class="code">
dev# PATH=/mnt/C/sys/X11/bin:$PATH ./util/modular/build.sh <b>-r app/xconsole</b> /mnt/C/sys/X11
...
Building app module component xdriinfo...
...
configure: error: cannot find GL library - make sure Mesa or other OpenGL package is installed
</pre>
For info how to get and build <i>Mesa library</i> see <a href="http://filodej.blogspot.com/2008/06/wmu-6500fs-xmlto-0020.html">this post</a>.
<br/>
After that we have to add the new include and library dirs to the environment:
<pre class="code">
dev# export LDFLAGS="-lGL -L/mnt/C/sys/lib -L/mnt/C/sys/X11/lib -lX11"
dev# export CFLAGS=-I/mnt/C/sys/include
</pre>
And then we can continue.
<pre class="code">
dev# PATH=/mnt/C/sys/X11/bin:$PATH ./util/modular/build.sh <b>-r app/xdriinfo -m /usr/local/src/Mesa-7.0.3</b> /mnt/C/sys/X11
...
Building app module component xsm...
...
configure: error: No rsh like program found
</pre>
For more details about this issue see <a href="http://lists.freebsd.org/pipermail/freebsd-ports-bugs/2007-May/120203.html">this</a> message. 
<br/>
<br/>
At the time I had not even the dropbear/ssh installed I decided to install it and solve the lack of rsh binary with the following fake:
<pre class="code">
dev# cd /mnt/C
dev# wget http://mgb111.pradnik.net/addons/servers-ssh/dropbear-ssh-sshd-050.3.tgz
dev# tar xzvf dropbear-ssh-sshd-050.3.tgz
dev# which ssh
/mnt/C/sys/bin/ssh
</pre>
Now we can create <i>rsh</i> names alias for the <i>ssh</i> binary. 
<pre class="code">
dev# ln -s /mnt/C/sys/bin/{s,r}sh
dev# rsh
Dropbear multi-purpose version 0.50
Make a symlink pointing at this binary with one of the following names:
'dropbear' - the Dropbear server
'dbclient' or 'ssh' - the Dropbear client
'dropbearkey' - the key generator
'dropbearconvert' - the key converter
'scp' - secure copy
dev# ls -l /mnt/C/sys/bin/rsh
lrwxrwxrwx  2 root root 18 Jun 25 14:42 /mnt/C/sys/bin/rsh -> /mnt/C/sys/bin/ssh*
dev# ls -l /mnt/C/sys/bin/ssh
lrwxrwxrwx  1 root root 13 Jun 17 14:34 /mnt/C/sys/bin/ssh -> dropbearmulti*
</pre>
The symlink method does not work. It is because of the fact that dropbear is the multiapplication and so the <i>ssh</i> binary is actually a symlink pointing to the binary called <i>dropbearmulti</i> binary. For such case the szmlink name matters, it can be one of the names listed above.
<br/>
We have another possibility, we can create a shell script calling ssh along with all its command line arguments:
<pre class="code">
dev# echo "\
> #!/bin/bash
> ssh \$1 \$2 \$3 \$4 \$5 \$6 \$7 \$8 \$9" > /mnt/C/sys/bin/rsh
dev# cat /mnt/C/sys/bin/rsh
#!/bin/bash
ssh $1 $2 $3 $4 $5 $6 $7 $8 $9
dev# chmod a+x /mnt/C/sys/bin/rsh
dev# rsh
Dropbear client v0.50
Usage: ssh [options] [user@]host [command]
Options are:
...
</pre>
Now back to the Xorg source directory and continue the building process:
<pre class="code">
dev# cd /usr/local/src/Xorg
dev# PATH=/mnt/C/sys/X11/bin:$PATH ./util/modular/build.sh <b>-r app/xsm</b> -m /usr/local/src/Mesa-7.0.3 /mnt/C/sys/X11
Building xserver module ...
...
checking for GL... configure: error: Package requirements (glproto >= 1.4.9 gl >= 7.1.0) were not met.
Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.

Alternatively you may set the GL_CFLAGS and GL_LIBS environment variables
to avoid the need to call pkg-config.  See the pkg-config man page for
more details.
</pre>
For now we can skip the <i>xserver</i> as well as the driver (we are interested in xclients mainly) modules:
<pre class="code">
dev# PATH=/mnt/C/sys/X11/bin:$PATH ./util/modular/build.sh <b>-r font/util</b> -m /usr/local/src/Mesa-7.0.3 /mnt/C/sys/X11
...
xcb module component util does not exist, skipping.
Wed Jun 25 13:21:59 MDT 2008

***** Skipped components (not available) *****
 xcb/util
</pre>
For now we are done with X.Org libraries, except the <i>xserver</i>, drivers and <i>xcb</i>. Maybe we come back to that later...
</span><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/183431720687819497-3580470190226740130?l=filodej.blogspot.com' alt='' /></div>
